let textArea = document.getElementById("inputText"); textArea.value = "forward right backward left"; let ws = null; let showDiv = document.getElementById('dataSent'); let connectedToCar = false; function OpenWebsocket() { const espIPaddress = document.getElementById('ipAddress').value; ws = new WebSocket("ws://"+espIPaddress+"/test"); ws.onopen = function() { document.getElementById("inputText").disabled = false; document.getElementById("sendButton").disabled = false; document.getElementById("connectButton").disabled = true; document.getElementById("disconnectButton").disabled = false; document.getElementById("ipAddress").disabled = true; connectedToCar = true; }; ws.onclose = function() { document.getElementById("inputText").disabled = true; document.getElementById("sendButton").disabled = true; document.getElementById("connectButton").disabled = false; document.getElementById("disconnectButton").disabled = true; document.getElementById("ipAddress").disabled = false; connectedToCar= false; }; }; function CloseWebsocket(){ ws.close(); }; function SendData(){ let textToSend = textArea.value; showDiv.value = "You Sent: " + textToSend; console.log(textToSend); ws.send(textToSend); } function sendToEsp32(textToSend){ ws.send(textToSend); } let pressedKey; let userPressedElse = false; function arrowTracking(){ userPressedElse = false; if(connectedToCar){ if(event.keyCode == 37) { if(pressedKey != event.keyCode){ sendToEsp32('left'); console.log('left'); pressedKey = 37; } }else if(event.keyCode == 38) { if(pressedKey != event.keyCode){ sendToEsp32("forward"); console.log('forward'); pressedKey = 38; } }else if(event.keyCode == 39 ) { if(pressedKey != event.keyCode){ sendToEsp32("right"); console.log('right'); pressedKey = 39; } }else if(event.keyCode == 40 ) { if(pressedKey != event.keyCode){ sendToEsp32("backward"); console.log('backward'); pressedKey = 40; } }else if(event.keyCode == 32){ if(pressedKey != event.keyCode ){ sendToEsp32("stop"); console.log('stop'); pressedKey = 32; } }else{ userPressedElse = true; } }else{ console.log('car not connected, make sure to connect the car'); } } document.addEventListener('keydown', arrowTracking); async function userReleasedButton(){ stillPressing = false; if(connectedToCar){ if(!userPressedElse){ sendToEsp32("stop"); console.log('stop'); pressedKey = 32; } } } document.addEventListener('keyup', userReleasedButton);